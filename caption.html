<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>AI Caption Pro v6.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet"/>
    <style>
        :root { --neon-pink: #ff0055; --bg: #05000a; }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg); color: white; background-image: radial-gradient(circle at 50% 0%, #1a001a, var(--bg) 80%); }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 2rem; }
        .platform-chip { padding: 10px 20px; border-radius: 50px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); font-size: 10px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .platform-chip.active { background: var(--neon-pink); border-color: var(--neon-pink); box-shadow: 0 0 15px var(--neon-pink); }
        #img-preview { width: 100%; max-height: 250px; object-fit: contain; border-radius: 1rem; margin-top: 15px; display: none; }
        .res-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 1.5rem; padding: 20px; margin-top: 15px; }
        .loader { display: none; flex-direction: column; align-items: center; justify-content: center; }
        .loader-ring { width: 30px; height: 30px; border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--neon-pink); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen p-6">

    <div class="max-w-xl mx-auto space-y-8">
        <header class="text-center">
            <h1 class="text-2xl font-black italic uppercase tracking-tighter">AI CAPTION <span class="text-pink-500">PRO</span></h1>
            <p class="text-[7px] font-bold text-white/20 uppercase tracking-[0.4em]">Neural Build v6.1.0 Stable</p>
        </header>

        <!-- 1. Upload -->
        <div onclick="document.getElementById('file-in').click()" class="glass p-8 text-center border-dashed border-2 border-white/5 cursor-pointer">
            <input type="file" id="file-in" class="hidden" accept="image/*" onchange="handleImage(event)">
            <i class="fa-solid fa-cloud-arrow-up text-2xl text-pink-500 mb-2"></i>
            <p class="text-[9px] font-black uppercase text-white/40">Upload Photo to Analyze</p>
            <img id="img-preview" src="">
        </div>

        <!-- 2. Platforms -->
        <div class="flex flex-wrap justify-center gap-2">
            <div class="platform-chip active" data-val="Instagram">Instagram</div>
            <div class="platform-chip" data-val="TikTok">TikTok</div>
            <div class="platform-chip" data-val="YouTube Shorts">Shorts</div>
            <div class="platform-chip" data-val="Facebook">Facebook</div>
        </div>

        <!-- 3. Action -->
        <button onclick="generateAI()" id="btn-gen" class="w-full py-4 bg-pink-600 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg">Generate Viral Content</button>

        <div id="loader" class="loader">
            <div class="loader-ring"></div>
            <p class="text-[8px] font-black uppercase tracking-[0.3em] text-pink-500 mt-4">AI ANALYZING PIXELS...</p>
        </div>

        <!-- 4. Output -->
        <div id="results" class="hidden pb-10">
            <div class="res-card">
                <div class="flex justify-between items-center mb-3"><span class="text-[8px] font-bold text-white/20 uppercase">Viral Captions</span><button onclick="copyText('res-cap')" class="text-blue-500 text-[8px] font-black uppercase">Copy</button></div>
                <p id="res-cap" class="text-sm leading-relaxed text-white/90"></p>
            </div>
            <div class="res-card">
                <div class="flex justify-between items-center mb-3"><span class="text-[8px] font-bold text-white/20 uppercase">Trending Hashtags</span><button onclick="copyText('res-tag')" class="text-blue-500 text-[8px] font-black uppercase">Copy</button></div>
                <p id="res-tag" class="text-xs leading-relaxed text-blue-400 font-bold"></p>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyDI7v-5DoTUWZBhajcpZk6ed9rH2GcAqLw", databaseURL: "https://a2ztools-6ea22-default-rtdb.asia-southeast1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();
        let API_KEY = "";
        db.ref('keys/GEMINI_PRO_KEY').on('value', s => { API_KEY = s.val(); });

        let base64Img = "", platform = "Instagram";

        document.querySelectorAll('.platform-chip').forEach(c => {
            c.onclick = () => {
                document.querySelectorAll('.platform-chip').forEach(x => x.classList.remove('active'));
                c.classList.add('active'); platform = c.dataset.val;
            };
        });

        function handleImage(e) {
            const file = e.target.files[0]; if(!file) return;
            const r = new FileReader();
            r.onload = (ev) => {
                document.getElementById('img-preview').src = ev.target.result;
                document.getElementById('img-preview').style.display = 'block';
                base64Img = ev.target.result.split(',')[1];
            };
            r.readAsDataURL(file);
        }

        async function generateAI() {
            if(!base64Img || !API_KEY) return alert("Pehle photo upload karein ya Key check karein!");
            
            const btn = document.getElementById('btn-gen');
            const loader = document.getElementById('loader');
            const resDiv = document.getElementById('results');

            btn.style.display = 'none';
            loader.style.display = 'flex';
            resDiv.classList.add('hidden');

            const payload = {
                contents: [{
                    parts: [
                        { text: `Task: Analyze this image. Generate 3 viral ${platform} captions and 30 trending hashtags. Format: [Captions]... [Hashtags]...` },
                        { inline_data: { mime_type: "image/png", data: base64Img } }
                    ]
                }],
                safetySettings: [
                    { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                    { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                ]
            };

            try {
                // Using Flash model for faster multimodal response
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content) {
                    const text = data.candidates[0].content.parts[0].text;
                    const parts = text.split(/hashtags/i);
                    document.getElementById('res-cap').innerText = parts[0].replace(/captions/i, '').trim();
                    document.getElementById('res-tag').innerText = (parts[1] || '').trim();
                    
                    loader.style.display = 'none';
                    btn.style.display = 'block';
                    resDiv.classList.remove('hidden');
                } else {
                    throw new Error("AI rejected the image. Try another one.");
                }

            } catch (err) {
                alert("Error: " + err.message);
                loader.style.display = 'none';
                btn.style.display = 'block';
            }
        }

        function copyText(id) {
            navigator.clipboard.writeText(document.getElementById(id).innerText);
            alert("Copied!");
        }
    </script>
</body>
</html>
