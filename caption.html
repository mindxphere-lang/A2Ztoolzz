<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>A2Z Studio - AI Caption Pro v6.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet"/>
    <style>
        :root { --neon-pink: #ff0055; --neon-blue: #007aff; --bg: #05000a; }
        body { 
            font-family: 'Montserrat', sans-serif; background: var(--bg); color: white; margin: 0; overflow-x: hidden;
            background-image: radial-gradient(circle at 50% 0%, #1a001a, var(--bg) 80%);
        }

        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 2rem; }
        
        /* Platform Chips */
        .platform-chip { 
            padding: 10px 20px; border-radius: 50px; background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.1); font-size: 10px; font-weight: 800; 
            text-transform: uppercase; cursor: pointer; transition: 0.3s;
        }
        .platform-chip.active { background: var(--neon-pink); border-color: var(--neon-pink); box-shadow: 0 0 15px var(--neon-pink); }

        /* Preview Image */
        #img-preview { width: 100%; max-height: 300px; object-fit: contain; border-radius: 1.5rem; display: none; margin-top: 20px; }

        /* Result Card */
        .res-card { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.05); border-radius: 1.5rem; padding: 20px; margin-top: 20px; }
        .copy-btn { color: var(--neon-blue); font-size: 10px; font-weight: 900; text-transform: uppercase; cursor: pointer; }

        .loader { display: none; flex-direction: column; items: center; justify-content: center; padding: 40px 0; }
        .loader-ring { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.05); border-top: 3px solid var(--neon-pink); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen p-6">

    <div class="max-w-xl mx-auto space-y-8">
        <nav><a href="index.html" class="text-white/30 text-xs"><i class="fa-solid fa-arrow-left mr-2"></i> Terminal Hub</a></nav>

        <header class="text-center">
            <h1 class="text-3xl font-black italic uppercase tracking-tighter text-white">AI <span class="text-pink-500">CAPTION</span> PRO</h1>
            <p class="text-[8px] font-bold text-white/20 uppercase tracking-[0.5em] mt-2">Neural Vision Build v6.0.0</p>
        </header>

        <!-- 1. Upload Zone -->
        <div id="upload-zone" onclick="document.getElementById('file-in').click()" class="glass p-10 text-center border-dashed border-2 border-white/5 cursor-pointer">
            <input type="file" id="file-in" class="hidden" accept="image/*" onchange="handleImage(event)">
            <i class="fa-solid fa-camera-retro text-3xl text-pink-500 mb-4"></i>
            <h2 class="text-sm font-black uppercase">Import Image</h2>
            <p class="text-[9px] text-white/30 mt-1 uppercase">AI will analyze your photo for viral content</p>
            <img id="img-preview" src="">
        </div>

        <!-- 2. Platform Selection -->
        <div class="space-y-4">
            <p class="text-center text-[9px] font-black uppercase text-pink-500/50 tracking-widest">Select Target Platform</p>
            <div class="flex flex-wrap justify-center gap-3" id="platforms">
                <div class="platform-chip active" data-name="Instagram">Instagram</div>
                <div class="platform-chip" data-name="TikTok">TikTok</div>
                <div class="platform-chip" data-name="YouTube Shorts">YouTube</div>
                <div class="platform-chip" data-name="Twitter/X">Twitter (X)</div>
                <div class="platform-chip" data-name="Facebook">Facebook</div>
            </div>
        </div>

        <!-- 3. Generate Button -->
        <button onclick="generateNeuralCaption()" id="gen-btn" class="w-full py-5 glass bg-pink-600/10 border-pink-500/20 text-white font-black text-xs uppercase tracking-widest transition active:scale-95">
            Generate Viral Metadata
        </button>

        <!-- 4. Loader -->
        <div id="loader" class="loader">
            <div class="loader-ring"></div>
            <p class="text-[9px] font-black uppercase tracking-[0.4em] text-pink-500 mt-6 animate-pulse">Gemini analyzing pixels...</p>
        </div>

        <!-- 5. Results Section -->
        <div id="results" class="hidden animate-fade-in pb-20">
            <!-- Caption Card -->
            <div class="res-card">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-[9px] font-black text-white/30 uppercase">Viral Captions</span>
                    <span class="copy-btn" onclick="copyText('res-caption')">Copy</span>
                </div>
                <p id="res-caption" class="text-sm leading-relaxed text-white/80 font-medium whitespace-pre-line"></p>
            </div>

            <!-- Hashtag Card -->
            <div class="res-card">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-[9px] font-black text-white/30 uppercase">Trending Hashtags</span>
                    <span class="copy-btn" onclick="copyText('res-tags')">Copy</span>
                </div>
                <p id="res-tags" class="text-xs leading-relaxed text-blue-400 font-bold"></p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyDI7v-5DoTUWZBhajcpZk6ed9rH2GcAqLw", databaseURL: "https://a2ztools-6ea22-default-rtdb.asia-southeast1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig); const db = firebase.database();
        
        let GEMINI_KEY = "";
        db.ref('keys/GEMINI_PRO_KEY').on('value', s => { GEMINI_KEY = s.val(); });

        let selectedPlatform = "Instagram";
        let imageData = "";

        // Platform Switcher
        document.querySelectorAll('.platform-chip').forEach(chip => {
            chip.onclick = function() {
                document.querySelectorAll('.platform-chip').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                selectedPlatform = this.dataset.name;
            }
        });

        // Image Preview Handler
        function handleImage(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (re) => {
                document.getElementById('img-preview').src = re.target.result;
                document.getElementById('img-preview').style.display = 'block';
                imageData = re.target.result.split(',')[1];
            };
            reader.readAsDataURL(file);
        }

        // --- THE NEURAL CAPTION ENGINE ---
        async function generateNeuralCaption() {
            if(!imageData) return alert("Pehle photo upload karein!");
            if(!GEMINI_KEY) return alert("Key missing in Admin!");

            document.getElementById('gen-btn').style.display = 'none';
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('results').classList.add('hidden');

            const prompt = `Analyze this image and generate viral content for ${selectedPlatform}. 
            Provide:
            1. Three viral captions (Short, Catchy, Engaging).
            2. 30 high-ranking trending hashtags for this specific photo.
            Format the response clearly.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${GEMINI_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                { inline_data: { mime_type: "image/png", data: imageData } }
                            ]
                        }]
                    })
                });

                const data = await response.json();
                const output = data.candidates[0].content.parts[0].text;

                // Split output into Captions and Hashtags
                const parts = output.split(/hashtags/i);
                document.getElementById('res-caption').innerText = parts[0].replace(/captions/i, '').trim();
                document.getElementById('res-tags').innerText = (parts[1] || '').trim();

                document.getElementById('loader').style.display = 'none';
                document.getElementById('gen-btn').style.display = 'block';
                document.getElementById('results').classList.remove('hidden');

            } catch (err) {
                alert("Gemini Node Busy! Try again.");
                document.getElementById('loader').style.display = 'none';
                document.getElementById('gen-btn').style.display = 'block';
            }
        }

        function copyText(id) {
            const text = document.getElementById(id).innerText;
            navigator.clipboard.writeText(text);
            alert("Copied to Clipboard!");
        }
    </script>
</body>
</html>
