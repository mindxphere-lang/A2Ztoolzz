<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>EXAR - Neural Media Node</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #030303;
            --card: rgba(20, 20, 20, 0.8);
            --accent: #ffffff;
            --exar-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #ec4899 100%);
        }

        body {
            background-color: var(--bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.1) 0px, transparent 50%);
            color: white;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .exar-glass {
            background: var(--card);
            backdrop-filter: blur(30px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 2rem;
        }

        .exar-input {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 1.5rem;
            transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .exar-input:focus-within {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
        }

        .btn-exar {
            background: #ffffff;
            color: #000000;
            font-weight: 800;
            border-radius: 1.2rem;
            transition: 0.3s;
        }

        .btn-exar:active {
            transform: scale(0.9);
            opacity: 0.8;
        }

        /* Floating Animation */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .float-anim { animation: float 4s ease-in-out infinite; }

        /* Loader - Scanning Effect */
        .scanner {
            width: 100%;
            height: 2px;
            background: var(--exar-gradient);
            position: absolute;
            top: 0;
            left: 0;
            animation: scan 2s linear infinite;
            box-shadow: 0 0 15px #6366f1;
        }

        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        /* Modern Scrollbar */
        ::-webkit-scrollbar { width: 0px; }

        .dl-progress-bar {
            height: 4px;
            background: var(--exar-gradient);
            width: 0%;
            transition: 0.3s;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-5">

    <!-- Navbar -->
    <nav class="max-w-4xl mx-auto flex justify-between items-center py-6 mb-12">
        <a href="index.html" class="w-12 h-12 flex items-center justify-center rounded-2xl exar-glass hover:bg-white/5 transition">
            <i class="fa-solid fa-arrow-left-long text-xs"></i>
        </a>
        <div class="px-5 py-2 rounded-full exar-glass border-white/10">
            <span class="text-[9px] font-black uppercase tracking-[0.3em] opacity-50">Node v3.0 Active</span>
        </div>
    </nav>

    <main class="max-w-xl mx-auto space-y-16">
        
        <!-- Big Hero Section -->
        <section class="text-center space-y-4">
            <h1 class="text-7xl font-black tracking-tighter uppercase italic leading-none">
                E<span class="text-transparent" style="-webkit-text-stroke: 1.5px white;">X</span>AR
            </h1>
            <p class="text-[10px] font-medium opacity-30 uppercase tracking-[0.8em]">Atmospheric Extraction</p>
        </section>

        <!-- Search Hub -->
        <div class="space-y-8">
            <div class="exar-input p-2 flex items-center group shadow-2xl">
                <button onclick="smartPaste()" class="w-14 h-14 flex items-center justify-center opacity-30 group-hover:opacity-100 transition">
                    <i class="fa-solid fa-paste text-lg"></i>
                </button>
                <input type="text" id="v-url" oninput="detect()"
                    class="bg-transparent flex-1 px-2 py-4 outline-none text-base font-medium placeholder:opacity-10"
                    placeholder="Enter link to capture...">
                <button onclick="fetchData()" class="btn-exar px-10 py-5 text-[10px] uppercase tracking-widest">
                    Capture
                </button>
            </div>

            <!-- Minimal Platform Status -->
            <div class="flex justify-center gap-6 opacity-20" id="plat-box">
                <i id="i-yt" class="fa-brands fa-youtube text-xl"></i>
                <i id="i-ins" class="fa-brands fa-instagram text-xl"></i>
                <i id="i-snap" class="fa-brands fa-snapchat text-xl"></i>
                <i id="i-tik" class="fa-brands fa-tiktok text-xl"></i>
            </div>
        </div>

        <!-- Sleek Loader -->
        <div id="v-loader" class="hidden relative py-20 text-center space-y-6">
            <div class="w-20 h-20 mx-auto border-t-2 border-white/20 rounded-full animate-spin"></div>
            <p class="text-[10px] font-bold uppercase tracking-widest opacity-40">Decrypting Stream...</p>
        </div>

        <!-- Result Content -->
        <div id="v-res" class="hidden animate-fade-in pb-32">
            <div class="exar-glass overflow-hidden relative border-white/5">
                <!-- Scanner effect inside result -->
                <div class="scanner"></div>

                <div class="p-2">
                    <img id="v-thumb" class="w-full h-64 object-cover rounded-[1.5rem] brightness-90 shadow-2xl" src="">
                </div>
                
                <div class="p-8">
                    <div class="flex justify-between items-start mb-10">
                        <div class="max-w-[70%]">
                            <h3 id="v-title" class="text-xl font-bold uppercase leading-tight truncate">Capturing Title</h3>
                            <p class="text-[9px] font-black uppercase opacity-20 mt-2 tracking-widest">Verified Neural Media</p>
                        </div>
                        <div class="w-10 h-10 rounded-full border border-white/10 flex items-center justify-center">
                            <i class="fa-solid fa-check text-[10px] text-green-500"></i>
                        </div>
                    </div>

                    <div id="v-links" class="space-y-4">
                        <!-- Items inject here -->
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        const config = { apiKey: "AIzaSyDI7v-5DoTUWZBhajcpZk6ed9rH2GcAqLw", databaseURL: "https://a2ztools-6ea22-default-rtdb.asia-southeast1.firebasedatabase.app" };
        firebase.initializeApp(config); const db = firebase.database();
        
        let apiBase = ""; 
        db.ref('settings/myDownloaderUrl').on('value', s => { apiBase = s.val(); });

        async function smartPaste() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('v-url').value = text;
                detect();
            } catch (err) { alert("Enable clipboard permissions."); }
        }

        async function fetchData() {
            const url = document.getElementById('v-url').value;
            if(!url) return;
            const loader = document.getElementById('v-loader');
            const resBox = document.getElementById('v-res');
            loader.classList.remove('hidden');
            resBox.classList.add('hidden');

            try {
                const response = await fetch(`${apiBase}/extract?url=${encodeURIComponent(url)}`);
                const data = await response.json();
                if(data.medias) {
                    renderResult(data);
                    resBox.classList.remove('hidden');
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                }
            } catch (e) { alert("Node Busy!"); }
            finally { loader.classList.add('hidden'); }
        }

        function renderResult(data) {
            document.getElementById('v-thumb').src = data.thumbnail;
            document.getElementById('v-title').innerText = data.title;
            const list = document.getElementById('v-links');
            list.innerHTML = '';

            data.medias.forEach((m, idx) => {
                const bId = `ex-${idx}`;
                list.innerHTML += `
                    <div class="space-y-4">
                        <div class="flex justify-between items-center bg-white/[0.02] p-6 rounded-[1.5rem] border border-white/5 hover:bg-white/[0.05] transition">
                            <div>
                                <p class="text-xs font-bold tracking-widest text-white/80">${m.quality}</p>
                                <p class="text-[8px] font-black opacity-20 uppercase mt-1">High Definition MP4</p>
                            </div>
                            <button id="${bId}" onclick="forceDownload('${m.url}', 'EXAR_${Date.now()}.mp4', '${bId}')"
                                class="w-12 h-12 flex items-center justify-center rounded-2xl bg-white text-black hover:scale-110 transition active:scale-90">
                                <i class="fa-solid fa-arrow-down-long"></i>
                            </button>
                        </div>
                        <div id="prog-p-${bId}" class="hidden px-2">
                            <div class="bg-white/5 h-1 rounded-full overflow-hidden">
                                <div id="bar-${bId}" class="dl-progress-bar"></div>
                            </div>
                            <div class="flex justify-between mt-2">
                                <span class="text-[7px] font-black opacity-20 uppercase">Capturing</span>
                                <span id="pct-${bId}" class="text-[7px] font-black text-indigo-400">0%</span>
                            </div>
                        </div>
                    </div>`;
            });
        }

        async function forceDownload(url, filename, bId) {
            const btn = document.getElementById(bId);
            const bar = document.getElementById(`bar-${bId}`);
            const pctText = document.getElementById(`pct-${bId}`);
            const parent = document.getElementById(`prog-p-${bId}`);

            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin text-xs"></i>`;
            btn.disabled = true;
            parent.classList.remove('hidden');

            try {
                const response = await fetch(url);
                const reader = response.body.getReader();
                const contentLength = +response.headers.get('Content-Length');
                let received = 0; let chunks = [];

                while(true) {
                    const {done, value} = await reader.read();
                    if (done) break;
                    chunks.push(value); received += value.length;
                    if (contentLength) {
                        const p = Math.floor((received / contentLength) * 100);
                        bar.style.width = p + "%"; pctText.innerText = p + "%";
                    }
                }
                const blob = new Blob(chunks);
                const blobUrl = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = blobUrl; a.download = filename;
                document.body.appendChild(a); a.click();
                setTimeout(() => { URL.revokeObjectURL(blobUrl); document.body.removeChild(a); }, 100);
                btn.innerHTML = `<i class="fa-solid fa-check"></i>`;
            } catch (e) {
                window.open(url, '_blank'); btn.innerHTML = `<i class="fa-solid fa-up-right-from-square"></i>`;
            }
            setTimeout(() => { btn.innerHTML = `<i class="fa-solid fa-arrow-down-long"></i>`; btn.disabled = false; parent.classList.add('hidden'); }, 5000);
        }

        function detect() {
            const val = document.getElementById('v-url').value.toLowerCase();
            const icons = {'i-yt':'youtube', 'i-ins':'instagram', 'i-snap':'snapchat', 'i-tik':'tiktok'};
            Object.keys(icons).forEach(id => {
                const el = document.getElementById(id);
                if(val.includes(icons[id])) { el.style.opacity = '1'; el.style.color = '#818cf8'; }
                else { el.style.opacity = '0.2'; el.style.color = 'white'; }
            });
        }
    </script>
</body>
</html>
