<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>UltraSaver - Direct Download</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #05000a;
            color: white;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-text {
            background: linear-gradient(to right, #00d2ff, #928DAB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="min-h-screen p-4">

    <div class="max-w-2xl mx-auto pt-12">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-black gradient-text mb-2">ULTRA SAVER</h1>
            <p class="text-gray-400 text-sm">YouTube • Instagram • TikTok</p>
        </div>

        <!-- Input Section -->
        <div class="glass-card rounded-3xl p-6 mb-6">
            <div class="flex gap-3 mb-4">
                <input
                    type="text"
                    id="urlInput"
                    placeholder="Video link paste karo..."
                    class="flex-1 bg-white/5 border border-white/10 rounded-2xl py-4 px-4 text-white placeholder-gray-500 outline-none focus:border-cyan-400"
                />
                <button
                    onclick="searchVideo()"
                    class="bg-gradient-to-r from-cyan-500 to-blue-600 px-8 py-4 rounded-2xl font-bold text-white hover:shadow-lg"
                >
                    Search
                </button>
            </div>

            <!-- Platform Icons -->
            <div class="flex gap-2 justify-center">
                <div id="yt-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500">YouTube</div>
                <div id="ig-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500">Instagram</div>
                <div id="tk-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500">TikTok</div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorBox" class="hidden bg-red-500/10 border border-red-500/50 rounded-2xl p-4 mb-6">
            <p id="errorText" class="text-red-400 text-sm"></p>
        </div>

        <!-- Loading -->
        <div id="loadingBox" class="hidden glass-card rounded-3xl p-12 border border-white/10 text-center mb-6">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
            <p class="text-cyan-400 font-bold">Video dhoondh rahe hain...</p>
        </div>

        <!-- Results -->
        <div id="resultsBox" class="hidden glass-card rounded-3xl p-6 border border-white/10">
            <img id="thumbnail" class="w-full rounded-2xl mb-6 hidden" />
            <div id="videoList"></div>
            
            <div class="mt-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl">
                <p class="text-yellow-400 text-xs text-center">
                    ⚠️ Browser security ki wajah se video new tab mein khulega. Wahan se right-click → "Save video as" karo
                </p>
            </div>
        </div>

        <!-- Instructions -->
        <div id="instructionsBox" class="glass-card rounded-3xl p-8 border border-white/10 text-center">
            <i class="fa-solid fa-download text-6xl text-gray-600 mb-4"></i>
            <h3 class="text-xl font-bold text-white mb-4">Kaise Use Kare?</h3>
            <ol class="text-gray-400 text-sm space-y-2 text-left max-w-md mx-auto">
                <li>1. YouTube/Instagram/TikTok se video link copy karo</li>
                <li>2. Upar input box mein paste karo</li>
                <li>3. Search button dabao</li>
                <li>4. Quality choose karke download karo</li>
            </ol>
        </div>
    </div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
    // Firebase Config
    const fbConfig = { 
        apiKey: "AIzaSyDI7v-5DoTUWZBhajcpZk6ed9rH2GcAqLw", 
        databaseURL: "https://a2ztools-6ea22-default-rtdb.asia-southeast1.firebasedatabase.app" 
    };
    firebase.initializeApp(fbConfig);
    const db = firebase.database();
    let apiKey = '';

    // Load API Key from Firebase
    db.ref('settings/videoKey').on('value', (snapshot) => {
        apiKey = snapshot.val();
        console.log('API Key loaded:', apiKey ? 'Yes' : 'No');
    });

    // Platform Detection
    document.getElementById('urlInput').addEventListener('input', (e) => {
        const url = e.target.value.toLowerCase();
        const ytBadge = document.getElementById('yt-badge');
        const igBadge = document.getElementById('ig-badge');
        const tkBadge = document.getElementById('tk-badge');

        // Reset
        ytBadge.className = igBadge.className = tkBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500';

        if (url.includes('youtube') || url.includes('youtu.be')) {
            ytBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-400 border border-red-500/50';
        } else if (url.includes('instagram')) {
            igBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-pink-500/20 text-pink-400 border border-pink-500/50';
        } else if (url.includes('tiktok')) {
            tkBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-white/20 text-white border border-white/50';
        }
    });

    // Search Video
    async function searchVideo() {
        const url = document.getElementById('urlInput').value.trim();
        
        if (!url) {
            showError('Link paste karo pehle!');
            return;
        }

        if (!apiKey) {
            showError('API Key load nahi hua! Page refresh karo.');
            return;
        }

        hideAll();
        document.getElementById('loadingBox').classList.remove('hidden');

        try {
            const response = await fetch('https://social-download-all-in-one.p.rapidapi.com/v1/social/autolink', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-RapidAPI-Key': apiKey,
                    'X-RapidAPI-Host': 'social-download-all-in-one.p.rapidapi.com'
                },
                body: JSON.stringify({ url: url })
            });

            const data = await response.json();
            console.log('API Response:', data);

            if (data.medias && data.medias.length > 0) {
                showResults(data);
            } else {
                showError('Video nahi mila! Link check karo.');
            }
        } catch (error) {
            console.error('Error:', error);
            showError('API Error! Network check karo ya link galat hai.');
        }

        document.getElementById('loadingBox').classList.add('hidden');
    }

    // Show Results
    function showResults(data) {
        hideAll();
        
        const resultsBox = document.getElementById('resultsBox');
        const thumbnail = document.getElementById('thumbnail');
        const videoList = document.getElementById('videoList');

        // Show thumbnail
        if (data.picture || data.thumbnail) {
            thumbnail.src = data.picture || data.thumbnail;
            thumbnail.classList.remove('hidden');
        }

        // Create video list
        videoList.innerHTML = '';
        data.medias.forEach((video, index) => {
            const quality = video.quality || 'Unknown';
            const extension = video.extension || 'mp4';
            const videoUrl = video.url;

            const card = document.createElement('div');
            card.className = 'bg-white/5 rounded-2xl p-4 border border-white/10 mb-3';
            card.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <span class="text-cyan-400 font-black text-sm uppercase">${quality}</span>
                        <span class="text-gray-500 text-xs ml-2">(${extension})</span>
                    </div>
                    <button 
                        onclick="downloadVideo('${videoUrl.replace(/'/g, "\\'")}', '${quality}')"
                        class="bg-cyan-600 hover:bg-cyan-500 px-6 py-3 rounded-xl font-bold text-sm text-white transition-all active:scale-95"
                    >
                        <i class="fa-solid fa-download mr-2"></i>Save
                    </button>
                </div>
            `;
            videoList.appendChild(card);
        });

        resultsBox.classList.remove('hidden');
    }

    // Download Video - SIMPLE & HONEST APPROACH
    function downloadVideo(videoUrl, quality) {
        console.log('Downloading:', videoUrl);

        // Create invisible anchor tag
        const link = document.createElement('a');
        link.href = videoUrl;
        link.download = `A2Z_${quality}_${Date.now()}.mp4`;
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // User ko batao kya karna hai
        setTimeout(() => {
            alert('Video new tab mein khul gaya! Wahan se:\n\n1. Right-click karo video par\n2. "Save video as..." select karo\n3. Download location choose karo\n\nYa video player ke 3-dots menu se download karo.');
        }, 500);
    }

    // Helper Functions
    function showError(message) {
        hideAll();
        document.getElementById('errorBox').classList.remove('hidden');
        document.getElementById('errorText').textContent = message;
    }

    function hideAll() {
        document.getElementById('errorBox').classList.add('hidden');
        document.getElementById('loadingBox').classList.add('hidden');
        document.getElementById('resultsBox').classList.add('hidden');
        document.getElementById('instructionsBox').classList.add('hidden');
    }
</script>

</body>
</html>
