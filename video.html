<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>UltraSaver - Mobile Downloader</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #05000a;
            color: white;
            -webkit-tap-highlight-color: transparent;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-text {
            background: linear-gradient(to right, #00d2ff, #928DAB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen p-4">

    <div class="max-w-2xl mx-auto pt-8">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-black gradient-text mb-2">ULTRA SAVER</h1>
            <p class="text-gray-400 text-sm">YouTube ‚Ä¢ Instagram ‚Ä¢ TikTok</p>
        </div>

        <!-- Input Section -->
        <div class="glass-card rounded-3xl p-4 md:p-6 mb-4">
            <div class="flex flex-col md:flex-row gap-3 mb-4">
                <input
                    type="text"
                    id="urlInput"
                    placeholder="Video link paste karo..."
                    class="flex-1 bg-white/5 border border-white/10 rounded-2xl py-4 px-4 text-white placeholder-gray-500 outline-none focus:border-cyan-400"
                />
                <button
                    onclick="searchVideo()"
                    class="bg-gradient-to-r from-cyan-500 to-blue-600 px-8 py-4 rounded-2xl font-bold text-white hover:shadow-lg active:scale-95 transition-all"
                >
                    <i class="fa-solid fa-search mr-2"></i>Search
                </button>
            </div>

            <!-- Platform Icons -->
            <div class="flex gap-2 justify-center">
                <div id="yt-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500">YouTube</div>
                <div id="ig-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500">Instagram</div>
                <div id="tk-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500">TikTok</div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorBox" class="hidden bg-red-500/10 border border-red-500/50 rounded-2xl p-4 mb-4">
            <p id="errorText" class="text-red-400 text-sm text-center"></p>
        </div>

        <!-- Loading -->
        <div id="loadingBox" class="hidden glass-card rounded-3xl p-12 border border-white/10 text-center mb-4">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
            <p class="text-cyan-400 font-bold">Video dhoondh rahe hain...</p>
        </div>

        <!-- Results -->
        <div id="resultsBox" class="hidden glass-card rounded-3xl p-4 md:p-6 border border-white/10 mb-4">
            <img id="thumbnail" class="w-full rounded-2xl mb-4 hidden" />
            <div id="videoList" class="space-y-3"></div>
        </div>

        <!-- Mobile Download Instructions Modal -->
        <div id="mobileModal" class="hidden fixed inset-0 bg-black/90 backdrop-blur-xl z-50 flex items-center justify-center p-4">
            <div class="glass-card rounded-3xl p-6 max-w-md w-full">
                <div class="text-center mb-4">
                    <div class="w-16 h-16 bg-cyan-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-mobile-screen-button text-3xl text-cyan-400"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Mobile Download Guide</h3>
                    <p id="deviceType" class="text-cyan-400 text-sm mb-4"></p>
                </div>

                <div id="androidSteps" class="hidden space-y-3 mb-6">
                    <div class="bg-white/5 rounded-xl p-4">
                        <p class="text-white font-bold mb-2">üì± Android Chrome:</p>
                        <ol class="text-gray-300 text-sm space-y-1 ml-4">
                            <li>1. Video player par <strong>long-press</strong> karo (2-3 sec)</li>
                            <li>2. Menu mein <strong>"Download video"</strong> ya <strong>"Save video"</strong> dikhe to tap karo</li>
                            <li>3. Agar nahi dikhe to video ke <strong>3-dots menu</strong> se download karo</li>
                        </ol>
                    </div>
                    <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-3">
                        <p class="text-yellow-400 text-xs">‚ö†Ô∏è Kuch videos browser download block kar deta hai. Aise case mein share button se <strong>"Save to Files"</strong> try karo.</p>
                    </div>
                </div>

                <div id="iosSteps" class="hidden space-y-3 mb-6">
                    <div class="bg-white/5 rounded-xl p-4">
                        <p class="text-white font-bold mb-2">üì± iPhone Safari:</p>
                        <ol class="text-gray-300 text-sm space-y-1 ml-4">
                            <li>1. Video par <strong>tap & hold</strong> karo (2-3 sec)</li>
                            <li>2. <strong>"Download Linked File"</strong> select karo</li>
                            <li>3. Download Files app mein save hoga</li>
                        </ol>
                    </div>
                    <div class="bg-white/5 rounded-xl p-4">
                        <p class="text-white font-bold mb-2">Alternative Method:</p>
                        <ol class="text-gray-300 text-sm space-y-1 ml-4">
                            <li>1. Safari ke <strong>Share button</strong> (‚¨ÜÔ∏è) dabao</li>
                            <li>2. <strong>"Save to Files"</strong> choose karo</li>
                            <li>3. Location select karke Save karo</li>
                        </ol>
                    </div>
                    <div class="bg-red-500/10 border border-red-500/30 rounded-xl p-3">
                        <p class="text-red-400 text-xs">‚ö†Ô∏è iOS Safari bahut strict hai. Agar download nahi ho raha to <strong>Documents by Readdle</strong> app install karo aur usme paste karo yeh link.</p>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button id="copyLinkBtn" onclick="copyVideoLink()" class="flex-1 bg-cyan-600 py-3 rounded-xl font-bold text-sm active:scale-95 transition-all">
                        <i class="fa-solid fa-copy mr-2"></i>Copy Link
                    </button>
                    <button onclick="closeMobileModal()" class="flex-1 bg-white/10 py-3 rounded-xl font-bold text-sm active:scale-95 transition-all">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div id="instructionsBox" class="glass-card rounded-3xl p-6 md:p-8 border border-white/10 text-center">
            <i class="fa-solid fa-download text-5xl md:text-6xl text-gray-600 mb-4"></i>
            <h3 class="text-lg md:text-xl font-bold text-white mb-4">Kaise Use Kare?</h3>
            <ol class="text-gray-400 text-sm space-y-2 text-left max-w-md mx-auto">
                <li>1. YouTube/Instagram/TikTok se video link copy karo</li>
                <li>2. Upar input box mein paste karo</li>
                <li>3. Search button dabao</li>
                <li>4. Quality choose karke download karo</li>
            </ol>
            
            <div class="mt-6 p-4 bg-cyan-500/10 border border-cyan-500/30 rounded-xl">
                <p class="text-cyan-400 text-xs">
                    üí° <strong>Mobile Users:</strong> Download button dabane ke baad instructions follow karo
                </p>
            </div>
        </div>
    </div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
    // Firebase Config
    const fbConfig = { 
        apiKey: "AIzaSyDI7v-5DoTUWZBhajcpZk6ed9rH2GcAqLw", 
        databaseURL: "https://a2ztools-6ea22-default-rtdb.asia-southeast1.firebasedatabase.app" 
    };
    firebase.initializeApp(fbConfig);
    const db = firebase.database();
    let apiKey = '';
    let currentVideoUrl = '';

    // Load API Key from Firebase
    db.ref('settings/videoKey').on('value', (snapshot) => {
        apiKey = snapshot.val();
        console.log('API Key loaded:', apiKey ? 'Yes' : 'No');
    });

    // Detect Device
    function isMobile() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function isIOS() {
        return /iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    function isAndroid() {
        return /Android/i.test(navigator.userAgent);
    }

    // Platform Detection
    document.getElementById('urlInput').addEventListener('input', (e) => {
        const url = e.target.value.toLowerCase();
        const ytBadge = document.getElementById('yt-badge');
        const igBadge = document.getElementById('ig-badge');
        const tkBadge = document.getElementById('tk-badge');

        ytBadge.className = igBadge.className = tkBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-white/5 text-gray-500';

        if (url.includes('youtube') || url.includes('youtu.be')) {
            ytBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-400 border border-red-500/50';
        } else if (url.includes('instagram')) {
            igBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-pink-500/20 text-pink-400 border border-pink-500/50';
        } else if (url.includes('tiktok')) {
            tkBadge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-white/20 text-white border border-white/50';
        }
    });

    // Search Video
    async function searchVideo() {
        const url = document.getElementById('urlInput').value.trim();
        
        if (!url) {
            showError('Link paste karo pehle!');
            return;
        }

        if (!apiKey) {
            showError('API Key load nahi hua! Page refresh karo.');
            return;
        }

        hideAll();
        document.getElementById('loadingBox').classList.remove('hidden');

        try {
            const response = await fetch('https://social-download-all-in-one.p.rapidapi.com/v1/social/autolink', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-RapidAPI-Key': apiKey,
                    'X-RapidAPI-Host': 'social-download-all-in-one.p.rapidapi.com'
                },
                body: JSON.stringify({ url: url })
            });

            const data = await response.json();
            console.log('API Response:', data);

            if (data.medias && data.medias.length > 0) {
                showResults(data);
            } else {
                showError('Video nahi mila! Link check karo.');
            }
        } catch (error) {
            console.error('Error:', error);
            showError('API Error! Network check karo ya link galat hai.');
        }

        document.getElementById('loadingBox').classList.add('hidden');
    }

    // Show Results
    function showResults(data) {
        hideAll();
        
        const resultsBox = document.getElementById('resultsBox');
        const thumbnail = document.getElementById('thumbnail');
        const videoList = document.getElementById('videoList');

        if (data.picture || data.thumbnail) {
            thumbnail.src = data.picture || data.thumbnail;
            thumbnail.classList.remove('hidden');
        }

        videoList.innerHTML = '';
        data.medias.forEach((video, index) => {
            const quality = video.quality || 'Unknown';
            const extension = video.extension || 'mp4';
            const videoUrl = video.url;

            const card = document.createElement('div');
            card.className = 'bg-white/5 rounded-2xl p-4 border border-white/10';
            card.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-cyan-400 font-black text-sm uppercase">${quality}</div>
                        <div class="text-gray-500 text-xs mt-1">${extension.toUpperCase()}</div>
                    </div>
                    <button 
                        onclick="downloadVideo('${videoUrl.replace(/'/g, "\\'").replace(/"/g, '&quot;')}', '${quality}')"
                        class="bg-cyan-600 hover:bg-cyan-500 px-6 py-3 rounded-xl font-bold text-sm text-white transition-all active:scale-95"
                    >
                        <i class="fa-solid fa-download mr-2"></i>Download
                    </button>
                </div>
            `;
            videoList.appendChild(card);
        });

        resultsBox.classList.remove('hidden');
    }

    // Download Video - MOBILE OPTIMIZED
    function downloadVideo(videoUrl, quality) {
        console.log('Download started:', videoUrl);
        currentVideoUrl = videoUrl;

        if (isMobile()) {
            // Mobile: Show instructions modal
            showMobileModal();
            
            // Try to trigger download anyway
            const a = document.createElement('a');
            a.href = videoUrl;
            a.download = `A2Z_${quality}_${Date.now()}.mp4`;
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        } else {
            // Desktop: Direct download
            const a = document.createElement('a');
            a.href = videoUrl;
            a.download = `A2Z_${quality}_${Date.now()}.mp4`;
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            setTimeout(() => {
                alert('Video new tab mein khul gaya!\n\nRight-click ‚Üí "Save video as" karo.');
            }, 500);
        }
    }

    // Show Mobile Instructions Modal
    function showMobileModal() {
        const modal = document.getElementById('mobileModal');
        const deviceType = document.getElementById('deviceType');
        const androidSteps = document.getElementById('androidSteps');
        const iosSteps = document.getElementById('iosSteps');

        if (isIOS()) {
            deviceType.textContent = 'üì± iPhone/iPad Detected';
            iosSteps.classList.remove('hidden');
            androidSteps.classList.add('hidden');
        } else if (isAndroid()) {
            deviceType.textContent = 'üì± Android Device Detected';
            androidSteps.classList.remove('hidden');
            iosSteps.classList.add('hidden');
        } else {
            deviceType.textContent = 'üì± Mobile Device';
            androidSteps.classList.remove('hidden');
            iosSteps.classList.remove('hidden');
        }

        modal.classList.remove('hidden');
    }

    function closeMobileModal() {
        document.getElementById('mobileModal').classList.add('hidden');
    }

    function copyVideoLink() {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(currentVideoUrl).then(() => {
                const btn = document.getElementById('copyLinkBtn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fa-solid fa-check mr-2"></i>Copied!';
                btn.classList.add('bg-green-600');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-600');
                }, 2000);
            });
        } else {
            alert('Link: ' + currentVideoUrl + '\n\nManually copy karo!');
        }
    }

    // Helper Functions
    function showError(message) {
        hideAll();
        document.getElementById('errorBox').classList.remove('hidden');
        document.getElementById('errorText').textContent = message;
    }

    function hideAll() {
        document.getElementById('errorBox').classList.add('hidden');
        document.getElementById('loadingBox').classList.add('hidden');
        document.getElementById('resultsBox').classList.add('hidden');
        document.getElementById('instructionsBox').classList.add('hidden');
    }
</script>

</body>
</html>
