<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>A2Z Studio - Vortex Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;900&display=swap" rel="stylesheet"/>
    <style>
        :root { --neon-red: #ff0055; --bg: #05000a; }
        body { 
            font-family: 'Montserrat', sans-serif; background: var(--bg); color: white; margin: 0; overflow-x: hidden;
            background: radial-gradient(circle at 50% 0%, #2a0015, var(--bg) 85%); background-attachment: fixed;
        }

        .vortex-wrapper { position: relative; width: 250px; height: 250px; margin: 30px auto; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .black-hole {
            position: relative; width: 150px; height: 150px; background: black; border-radius: 50%;
            box-shadow: 0 0 50px 10px var(--neon-red), inset 0 0 30px var(--neon-red);
            z-index: 10; display: flex; align-items: center; justify-content: center; text-align: center;
        }
        .black-hole span { font-size: 11px; font-weight: 900; letter-spacing: 2px; color: white; text-shadow: 0 0 10px var(--neon-red); }
        .vortex-ring { position: absolute; inset: 0; border: 2px dashed rgba(255, 0, 85, 0.3); border-radius: 50%; animation: spin 8s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .hyper-pulse { animation: hyper 0.5s infinite alternate; }
        @keyframes hyper { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

        .video-box { position: relative; width: 100%; border-radius: 2rem; overflow: hidden; background: #000; border: 1px solid rgba(255, 0, 85, 0.3); }
        .dl-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 1.5rem; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; margin-top: 10px;}
        .btn-save { background: linear-gradient(45deg, #ff0055, #ff4d88); padding: 10px 25px; border-radius: 12px; font-size: 10px; font-weight: 900; color: white; }
        
        input#manual-url { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,0,85,0.2); border-radius: 15px; width: 100%; padding: 15px; color: white; font-size: 12px; margin-bottom: 20px; outline: none; }
        input#manual-url:focus { border-color: var(--neon-red); }
    </style>
</head>
<body class="min-h-screen">

    <nav class="p-6"><a href="index.html" class="text-pink-500 font-black uppercase text-[10px]"><i class="fa-solid fa-arrow-left mr-2"></i> Back</a></nav>

    <div class="max-w-xl mx-auto px-6 pb-20">
        <!-- Manual Input as Fallback -->
        <input type="text" id="manual-url" placeholder="Paste link here if Auto-Paste fails...">

        <div class="vortex-wrapper" onclick="startProcess()">
            <div class="vortex-ring"></div>
            <div class="black-hole" id="bh-core"><span id="bh-text">TAP TO<br>PROCESS</span></div>
        </div>

        <div id="status-msg" class="text-center text-[10px] font-black uppercase tracking-widest text-pink-500/40 mb-10">System Ready</div>

        <div id="v-results" class="hidden space-y-6">
            <div class="video-box">
                <video id="v-player" controls playsinline class="w-full aspect-video bg-black"></video>
            </div>
            <div id="v-links" class="space-y-2"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyDI7v-5DoTUWZBhajcpZk6ed9rH2GcAqLw", databaseURL: "https://a2ztools-6ea22-default-rtdb.asia-southeast1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig); 
        const db = firebase.database();
        let keys = {}; 
        db.ref('settings').on('value', (s) => { keys = s.val() || {}; console.log("Keys Loaded:", keys); });

        async function startProcess() {
            const manualUrl = document.getElementById('manual-url').value;
            let url = manualUrl;

            // Try Auto-Paste if manual is empty
            if (!url) {
                try {
                    url = await navigator.clipboard.readText();
                } catch (err) {
                    console.log("Clipboard access denied");
                }
            }

            if (!url || !url.startsWith('http')) {
                alert("Please paste a valid link first!");
                return;
            }

            if (!keys.videoKey) {
                alert("API Key missing! Check Admin Panel.");
                return;
            }

            const core = document.getElementById('bh-core'), text = document.getElementById('bh-text'), statusMsg = document.getElementById('status-msg');
            
            core.classList.add('hyper-pulse');
            text.innerHTML = "FETCHING...";
            statusMsg.innerText = "Connecting to RapidAPI...";

            try {
                const res = await fetch(`https://social-download-all-in-one.p.rapidapi.com/v1/social/autolink`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json', 
                        'X-RapidAPI-Key': keys.videoKey, 
                        'X-RapidAPI-Host': 'social-download-all-in-one.p.rapidapi.com' 
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await res.json();
                console.log("API Response:", data);

                if (data.medias && data.medias.length > 0) {
                    renderResults(data);
                    text.innerHTML = "SUCCESS";
                    statusMsg.innerText = "Video Decrypted!";
                } else {
                    throw new Error(data.message || "Invalid Response");
                }
            } catch (e) { 
                text.innerHTML = "ERROR"; 
                statusMsg.innerText = "Fetch Failed. Check API Key or Link.";
                alert("Error: " + e.message);
            } finally {
                core.classList.remove('hyper-pulse');
            }
        }

        function renderResults(data) {
            const player = document.getElementById('v-player');
            const linksBox = document.getElementById('v-links');
            player.src = data.medias[0].url; 
            linksBox.innerHTML = '';

            data.medias.forEach(m => {
                if (m.extension === "mp4") {
                    const card = document.createElement('div');
                    card.className = "dl-card";
                    card.innerHTML = `
                        <p class="text-[10px] font-black uppercase">${m.quality}</p>
                        <button onclick="downloadVideo('${m.url}')" class="btn-save">DOWNLOAD</button>
                    `;
                    linksBox.appendChild(card);
                }
            });
            document.getElementById('v-results').classList.remove('hidden');
        }

        async function downloadVideo(videoUrl) {
            const statusMsg = document.getElementById('status-msg');
            statusMsg.innerText = "Starting Download...";
            try {
                const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(videoUrl);
                const res = await fetch(proxyUrl);
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `A2Z_Vortex_${Date.now()}.mp4`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                statusMsg.innerText = "Download Complete!";
            } catch (err) {
                window.open(videoUrl, '_blank');
            }
        }
    </script>
</body>
</html>
